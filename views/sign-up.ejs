<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" 
        rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" 
        crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" 
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <title>Sign Up</title>
</head>
<body>
      <%- include('./includes/navbar.ejs') %>
     <div class="container-fluid mt-5 d-flex justify-content-center" >
        <form 
            action="/user/sign-up" 
            class="w-25" 
            method="post" 
            onsubmit="validatePassword()"
            >
            <h2 class="fw-bold fs-4 text-muted display-3 m-4 mb-2">Sing Up</h2>
            <% if (message) { %>
                <div class="alert alert-danger from-control m-3 p-4" role="alert">
                    <%= message %>
                </div>
            <% } %>
            <div class="form-control m-3 p-4">
                <div class="row">
                    <div class="col-12 mt-2 mb-3">
                        <label for="" class="form-label fs-4">Username
                            <span class="fs-6 text-secondary fst-italic">(Email)</span>
                        </label>
                        <input type="text" name="username" class="form-control" required>
                    </div>
                </div>
                <div class="row">
                    <label for="" class="form-label fs-4">Password</label>
                    <div class="col-10 mt-2 mb-3">
                        <input 
                            type="password" 
                            name="password" 
                            class="form-control" 
                            id="passwordInp"
                            placeholder="Password"
                            onkeyup="validatePassword()" 
                            required>
                    </div>
                    <div class="col-2 mt-2 mb-3 btn">
                        <i class="bi bi-eye-slash" name="passwordHidden" onclick="toggleDisplay(this)"></i>
                    </div>
                </div>
                 <div class="row">
                 <label for="" class="form-label fs-4">Confirm Password</label>
                    <div class="col-10 mt-2 mb-3">
                        <input 
                            type="password" 
                            name="confirmPassword" 
                            class="form-control" 
                            id="confirmPasswordInp" 
                            placeholder="Confirm Password"
                            onkeyup="validatePassword()" 
                            required>
                    </div>
                    <div class="col-2 mt-2 mb-3 btn">
                        <i class="bi bi-eye-slash" name="confirmPasswordHidden" onclick="toggleDisplay(this)"></i>
                    </div>
                    <div class="text-danger" id="helper-text"></div>
                </div>
                
            </div>
            <div class=" mt-2 mb-3">
            <button class="btn btn-primary fs-4 m-3 w-100" type="submit">
                <i class="bi bi-box-arrow-in-right m-2"></i>Sign Up</button>
                </div>
        </form>
     </div>
     <script>
        let passwordInp = document.getElementById('passwordInp');
        let confirmPasswordInp = document.getElementById('confirmPasswordInp');

        const toggleDisplay = (element) => {
           let selectedToggle = element.getAttribute('name');
           switch(selectedToggle){
            case 'passwordHidden':
                passwordInp.type = 'text'
                element.className = 'bi bi-eye';
                element.setAttribute('name', 'passwordVisible');
                break;
            case 'passwordVisible':
                passwordInp.type = 'password'
                element.className = 'bi bi-eye-slash';
                element.setAttribute('name', 'passwordHidden');
                break;
            case 'confirmPasswordHidden':
                confirmPasswordInp.type = 'text'
                element.className = 'bi bi-eye';
                element.setAttribute('name', 'confirmPasswordVisible');
                break;
            case 'confirmPasswordVisible':
                 confirmPasswordInp.type = 'password'
                element.className = 'bi bi-eye-slash';
                element.setAttribute('name', 'confirmPasswordHidden');
                break;
            default:
                break;
           }
        }

        const validatePassword = () => {
            if (passwordInp.value === confirmPasswordInp.value) {
                document.getElementById('helper-text').innerText = '';
                return true;
            } else {
                document.getElementById('helper-text').innerText = 'Password do not match';
                event.preventDefault();
                return false;
            }
        }
     </script>
</body>
</html>